
<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="" name="description"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>MongoEngine Inside: the Detail of MongoDB &amp; MongoEngine | PyCon Taiwan 2018</title>
<link href="/pycon_archive_past_website/2018/static/pycontw-2018/assets/favicon.ico" rel="shortcut icon"/>
<link href="/pycon_archive_past_website/2018/static/pycontw-2018/assets/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"/>
<link href="/pycon_archive_past_website/2018/static/pycontw-2018/assets/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"/>
<meta content="" property="og:description"/>
<meta content="https://tw.pycon.org/pycon_archive_past_website/2018/static/pycontw-2018/assets/og-image.png" property="og:image"/>
<link href="https://fonts.googleapis.com/earlyaccess/notosanstc.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Roboto+Mono:300,400|Raleway:300,400" rel="stylesheet"/>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet"/>
<link href="/pycon_archive_past_website/2018/static/CACHE/css/ec9171fb3d99.css" rel="stylesheet" type="text/css">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TNZ39PD');</script>
</link></head>
<body class="talk-detail">
<noscript><iframe height="0" src="https://www.googletagmanager.com/ns.html?id=GTM-TNZ39PD" style="display:none;visibility:hidden" width="0"></iframe></noscript>
<div data-controller="topNav">
<nav class="top-navbar">
<form  class="navbar-lang-switch" >

<input name="next" type="hidden" value="/pycon_archive_past_website/2018/events/talk/596392410724958397/"/>
<button name="language" type="submit" value="zh-hant">
				<a href='/pycon_archive_past_website/2018/zh-hant/events/talk/596392410724958397/' class="myclass">ZH</a>
			</button>
<button disabled="disabled" name="language" type="submit" value="en-us">
				EN
			</button>
</form>
<div class="navbar-centerbox">
<a class="navbar-logo" href="/pycon_archive_past_website/2018/en-us/"></a>
</div>
<button aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler no-script" data-action="topNav#toggle" data-target="topNav.toggler" type="button">
<div><span></span><span></span><span></span></div>
</button>
<div class="navbar-social-desktop">
<a aria-label="Blog" class="fa fa-book" href="https://pycontw.blogspot.tw/" rel="noopener" target="_blank"></a>
<a aria-label="Facebook" class="fa fa-facebook-official" href="https://www.facebook.com/pycontw" rel="noopener" target="_blank"></a>
<a aria-label="Twitter" class="fa fa-twitter" href="https://twitter.com/pycontw" rel="noopener" target="_blank"></a>
<a aria-label="Email" class="fa fa-envelope" href="mailto:organizers@pycon.tw"></a>
</div>
</nav>
<nav class="menu-navbar-mobile no-script" data-target="topNav.menu">
<ul class="menu" data-controller="menu">
<li>
<a href="/pycon_archive_past_website/2018/en-us/about/pycontw/">About</a>
</li>
<li>
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-mobile-conference" type="checkbox"/>
<label for="menu-navbar-mobile-conference">Conference</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/events/overview/">Overview</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/schedule/">Schedule</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/keynotes/">Keynotes</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/talks/">Talks</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/speaking/recording/">Recording</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/portal/">Portal</a></li>
</ul>
</div>
</li>
<li>
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-mobile-events" type="checkbox"/>
<label for="menu-navbar-mobile-events">Exchange</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/events/tutorials/">Learning</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/sprints/">Sprints</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/open-spaces/">Open Spaces</a></li>
</ul>
</div>
</li>
<li>
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-mobile-registration" type="checkbox"/>
<label for="menu-navbar-mobile-registration">Registration</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/registration/ticket-info/">Conference Ticket</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/registration/financial-aid/">Financial Aid</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/registration/registration/">Registration</a></li>
</ul>
</div>
</li>
<li>
<a href="/pycon_archive_past_website/2018/en-us/venue/">Venue</a>
</li>
<li>
<a href="/pycon_archive_past_website/2018/en-us/dashboard/">My PyCon</a>
</li>
</ul>
<div class="navbar-social-mobile">
<a aria-label="Blog" class="fa fa-book" href="https://pycontw.blogspot.tw/" rel="noopener" target="_blank"></a>
<a aria-label="Facebook" class="fa fa-facebook-official" href="https://www.facebook.com/pycontw" rel="noopener" target="_blank"></a>
<a aria-label="Twitter" class="fa fa-twitter" href="https://twitter.com/pycontw" rel="noopener" target="_blank"></a>
<a aria-label="Email" class="fa fa-envelope" href="mailto:organizers@pycon.tw"></a>
</div>
</nav>
</div>
<header class="page-hero">
<nav class="menu-navbar-desktop">
<a class="menu-logo" href="/pycon_archive_past_website/2018/en-us/"></a>
<ul class="menu" data-controller="menu">
<li>
<a href="/pycon_archive_past_website/2018/en-us/about/pycontw/">About</a>
</li>
<li data-action="mouseover-&gt;menu#open mouseout-&gt;menu#close" data-target="menu.item">
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-desktop-conference" type="checkbox"/>
<label for="menu-navbar-desktop-conference">Conference</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/events/overview/">Overview</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/schedule/">Schedule</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/keynotes/">Keynotes</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/talks/">Talks</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/speaking/recording/">Recording</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/portal/">Portal</a></li>
</ul>
</div>
</li>
<li data-action="mouseover-&gt;menu#open mouseout-&gt;menu#close" data-target="menu.item">
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-desktop-events" type="checkbox"/>
<label for="menu-navbar-desktop-events">Exchange</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/events/tutorials/">Learning</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/sprints/">Sprints</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/events/open-spaces/">Open Spaces</a></li>
</ul>
</div>
</li>
<li data-action="mouseover-&gt;menu#open mouseout-&gt;menu#close" data-target="menu.item">
<input data-action="change-&gt;menu#exclude" data-target="menu.checker" hidden="hidden" id="menu-navbar-desktop-registration" type="checkbox"/>
<label for="menu-navbar-desktop-registration">Registration</label>
<div class="dropdown">
<ul class="submenu">
<li><a href="/pycon_archive_past_website/2018/en-us/registration/ticket-info/">Conference Ticket</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/registration/financial-aid/">Financial Aid</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/registration/registration/">Registration</a></li>
</ul>
</div>
</li>
<li>
<a href="/pycon_archive_past_website/2018/en-us/venue/">Venue</a>
</li>
<li>
<a href="/pycon_archive_past_website/2018/en-us/dashboard/">My PyCon</a>
</li>
</ul>
</nav>
</header>
<main>
<h1>MongoEngine Inside: the Detail of MongoDB &amp; MongoEngine</h1>
<section class="talk-content talk-info">
<ul>
<li>
<dfn class="location">Location: </dfn>
<span>R2</span>
</li>
<li>
<dfn class="slot">Slot: </dfn>
<span>Day 2, 10:35‑11:05</span>
</li>
<li>
<dfn class="category">Category: </dfn>
<span>Databases</span>
</li>
<li>
<dfn class="language zhen">Language: </dfn>
<span>Chinese talk w. English slides</span>
</li>
<li>
<dfn class="python-level experienced">Python Level: </dfn>
<span>Experienced</span>
</li>
</ul>
</section>
<h2>Abstract</h2>
<section class="talk-content">
<p>Making MongoDB working does not mean that understanding the details of MongoDB.<br/>Especially when using an ORM library such as MongoEngine, write working codes to query and update data in MongoDB is simple, but apply these codes to large scale environment, it might become disaster. The disaster might be server unresponsive due to long-time query and long-time update, or even worse, corrupt data due to race condition.<br/>I will share some guides related to MongoEngine usage. Hope these guides can help everyone to implement efficient and reliable application which manages huge data by accessing MongoDB via MongoEngine.</p>
</section>
<h2>Description</h2>
<section class="talk-content editor-readonly">
<div class="editor-preview">1. when MongoEngine
       1-1: use PyMongo or use MongoEngine?
2. from ORM to BSON
       2-1: read MongoEngine source code to show how MongoEngine read from and .save() to MongoDB
       2-2: how MongoEngine automatically dereference ObjectID as embedded document
       2-3: .save() help us to write less bytes, but we also need to read less bytes
            how to pass needed fields use .only() or .exclude()
            how it affect .save()
3. race condition
       3-1: introduce .objects().modify() and .objects().update()
       3-2: how ORM design affects your implementation of atomic accessing:
           3-2-1: store data in denormalization way (embedded documents): update atomically is trivial but data size is limited
           3-2-2: store data in referencing way (independent documents): update atomically need brainstorming
4. index
       4-1: index detail
           4-1-1: difference between sortable index and hash (non sortable) index
           4-1-2: no operation include upsert can ensure unique
                  so if it is an unique field value, apply unique index
           4-1-3: some details when indexing array field (including unique index for array field)
       4-2: compound index
           4-2-1: read query plan to understand what happened when query MongoDB
           4-2-2: from 4-2-1 we can understand the gold indexing slogan: equal, sort, range
5. migration tips
       if can, use .update(multi=True) with some operation based on current value</div>
</section>
<h2>Slides</h2>
<section class="talk-content">
<p><a href="https://hackmd.io/p/BkqA55Epf#/">https://hackmd.io/p/BkqA55Epf#/</a></p>
</section>
<h2>
	
	Speaker
	
</h2>
<article class="media">
<header>
<figure>
<img src="/pycon_archive_past_website/2018/media/cache/ff/2a/ff2aac65a95695ed865f4afe26be0ed3.jpg"/>
<figcaption>郭學聰 (Hsueh-Tsung Kuo)</figcaption>
</figure>
</header>
<div class="talk-content">
<p>台灣某game會社的小小RD<br/>目前是CPPRG(C# Perl Python Ruby Golang)熟手<br/>Smalltalk與Scheme基本教義派<br/>不是太奇怪的程式語言都會一些</p>
<p>請多多指教⎝（˶′◡‵˶）⎠</p>
<div class="social">
<a href="https://github.com/fieliapm" rel="noopener" target="_blank"><span aria-hidden="true" class="fa fa-github"></span></a>
<a href="https://twitter.com/fieliapm" rel="noopener" target="_blank"><span aria-hidden="true" class="fa fa-twitter"></span></a>
<a href="https://www.facebook.com/fieliapm" rel="noopener" target="_blank"><span aria-hidden="true" class="fa fa-facebook"></span></a>
</div>
</div>
</article>
</main>
<footer>
<h2 class="footer-logo"></h2>
<ul>
<li><a href="/pycon_archive_past_website/2018/en-us/about/code-of-conduct/">Code of Conduct</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/about/staff/">Staff</a></li>
<li><a href="/pycon_archive_past_website/2018/en-us/about/community/">Community</a></li>
</ul>
<p class="copyright">2018 PyCon Taiwan</p>
</footer>
<script src="/pycon_archive_past_website/2018/static/CACHE/js/ce994d83f936.js" type="text/javascript"></script>
<script src="/pycon_archive_past_website/2018/static/js/vendors/simplemde.min.js"></script>
<script src="/pycon_archive_past_website/2018/static/js/tools/simplemde-setup.js"></script>
</body>
</html>
<style>.myclass{text-decoration: none;color: rgba(255, 255, 255, 0.35);}.myclass:hover{text-decoration: none;color: rgba(255, 255, 255, 0.7);}</style>